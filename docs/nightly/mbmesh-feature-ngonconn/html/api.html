
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>API &#8212; ESMPy 8.3.0 beta snapshot documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/classic.css" />
    
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Appendices" href="appendix.html" />
    <link rel="prev" title="Tutorials" href="examples.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="appendix.html" title="Appendices"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="examples.html" title="Tutorials"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">ESMPy 8.3.0 beta snapshot documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">API</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="api">
<h1>API<a class="headerlink" href="#api" title="Permalink to this headline">¶</a></h1>
<section id="classes">
<h2>Classes<a class="headerlink" href="#classes" title="Permalink to this headline">¶</a></h2>
<p>ESMPy uses a <a class="reference internal" href="field.html#ESMF.api.field.Field" title="ESMF.api.field.Field"><code class="xref py py-class docutils literal notranslate"><span class="pre">Field</span></code></a> object to represent data variables
built on an underlying spatial discretization, which is represented by a
<a class="reference internal" href="grid.html#ESMF.api.grid.Grid" title="ESMF.api.grid.Grid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Grid</span></code></a>, <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a> or
<a class="reference internal" href="locstream.html#ESMF.api.locstream.LocStream" title="ESMF.api.locstream.LocStream"><code class="xref py py-class docutils literal notranslate"><span class="pre">LocStream</span></code></a>.
Regridding between <a class="reference internal" href="field.html#ESMF.api.field.Field" title="ESMF.api.field.Field"><code class="xref py py-class docutils literal notranslate"><span class="pre">Fields</span></code></a> is accomplished with the
<a class="reference internal" href="regrid.html#ESMF.api.regrid.Regrid" title="ESMF.api.regrid.Regrid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Regrid</span></code></a> class.  All of these classes are explained in
more detail in the sections provided by the links in the following table.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 24%" />
<col style="width: 76%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Class</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference internal" href="manager.html#ESMF.api.esmpymanager.Manager" title="ESMF.api.esmpymanager.Manager"><code class="xref py py-class docutils literal notranslate"><span class="pre">Manager</span></code></a></p></td>
<td><p>A manager class to initialize and finalize ESMF</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="field.html#ESMF.api.field.Field" title="ESMF.api.field.Field"><code class="xref py py-class docutils literal notranslate"><span class="pre">Field</span></code></a></p></td>
<td><p>A data field built on a <a class="reference internal" href="grid.html#ESMF.api.grid.Grid" title="ESMF.api.grid.Grid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Grid</span></code></a>, <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a>, or <a class="reference internal" href="locstream.html#ESMF.api.locstream.LocStream" title="ESMF.api.locstream.LocStream"><code class="xref py py-class docutils literal notranslate"><span class="pre">LocStream</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="grid.html#ESMF.api.grid.Grid" title="ESMF.api.grid.Grid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Grid</span></code></a></p></td>
<td><p>A class to represent a logically rectangular grid</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a></p></td>
<td><p>A class to represent an unstructured grid</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="locstream.html#ESMF.api.locstream.LocStream" title="ESMF.api.locstream.LocStream"><code class="xref py py-class docutils literal notranslate"><span class="pre">LocStream</span></code></a></p></td>
<td><p>A class to represent observational data as a collection of disconnected points</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="regrid.html#ESMF.api.regrid.Regrid" title="ESMF.api.regrid.Regrid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Regrid</span></code></a></p></td>
<td><p>The regridding utility</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="regridfromfile.html#ESMF.api.regrid.RegridFromFile" title="ESMF.api.regrid.RegridFromFile"><code class="xref py py-class docutils literal notranslate"><span class="pre">RegridFromFile</span></code></a></p></td>
<td><p>The from file regridding utility</p></td>
</tr>
</tbody>
</table>
</section>
<section id="named-constants">
<h2>Named Constants<a class="headerlink" href="#named-constants" title="Permalink to this headline">¶</a></h2>
<p>ESMPy follows the ESMF convention of using “named constants” to represent the
available options for parameters that expect a variety of specific inputs.  The
following table lists the available named constants and provides links to pages
that further explain the available values.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 35%" />
<col style="width: 65%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Named constants</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference internal" href="CoordSys.html#ESMF.api.constants.CoordSys" title="ESMF.api.constants.CoordSys"><code class="xref py py-class docutils literal notranslate"><span class="pre">CoordSys</span></code></a></p></td>
<td><p>Specify the coordinate system of a <a class="reference internal" href="grid.html#ESMF.api.grid.Grid" title="ESMF.api.grid.Grid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Grid</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="ExtrapMethod.html#ESMF.api.constants.ExtrapMethod" title="ESMF.api.constants.ExtrapMethod"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExtrapMethod</span></code></a></p></td>
<td><p>Specify the extrapolation method</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="FileFormat.html#ESMF.api.constants.FileFormat" title="ESMF.api.constants.FileFormat"><code class="xref py py-class docutils literal notranslate"><span class="pre">FileFormat</span></code></a></p></td>
<td><p>Specify the format of a data file</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="FileMode.html#ESMF.api.constants.FileMode" title="ESMF.api.constants.FileMode"><code class="xref py py-class docutils literal notranslate"><span class="pre">FileMode</span></code></a></p></td>
<td><p>Specify the mode of a data file</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="GridItem.html#ESMF.api.constants.GridItem" title="ESMF.api.constants.GridItem"><code class="xref py py-class docutils literal notranslate"><span class="pre">GridItem</span></code></a></p></td>
<td><p>Specify a mask or area item on a <a class="reference internal" href="grid.html#ESMF.api.grid.Grid" title="ESMF.api.grid.Grid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Grid</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="LineType.html#ESMF.api.constants.LineType" title="ESMF.api.constants.LineType"><code class="xref py py-class docutils literal notranslate"><span class="pre">LineType</span></code></a></p></td>
<td><p>Specify the type of line that connects two points on a sphere</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="LogKind.html#ESMF.api.constants.LogKind" title="ESMF.api.constants.LogKind"><code class="xref py py-class docutils literal notranslate"><span class="pre">LogKind</span></code></a></p></td>
<td><p>Specify how much logging should be done</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="MeshElemType.html#ESMF.api.constants.MeshElemType" title="ESMF.api.constants.MeshElemType"><code class="xref py py-class docutils literal notranslate"><span class="pre">MeshElemType</span></code></a></p></td>
<td><p>Specify the type of the <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a> elements</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="MeshLoc.html#ESMF.api.constants.MeshLoc" title="ESMF.api.constants.MeshLoc"><code class="xref py py-class docutils literal notranslate"><span class="pre">MeshLoc</span></code></a></p></td>
<td><p>Specify a nodal or elemental <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="NormType.html#ESMF.api.constants.NormType" title="ESMF.api.constants.NormType"><code class="xref py py-class docutils literal notranslate"><span class="pre">NormType</span></code></a></p></td>
<td><p>Specify the type of normalization to use for conservative regridding weights</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="PoleKind.html#ESMF.api.constants.PoleKind" title="ESMF.api.constants.PoleKind"><code class="xref py py-class docutils literal notranslate"><span class="pre">PoleKind</span></code></a></p></td>
<td><p>Specify the type of connection that appears at the poles of the <a class="reference internal" href="grid.html#ESMF.api.grid.Grid" title="ESMF.api.grid.Grid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Grid</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="PoleMethod.html#ESMF.api.constants.PoleMethod" title="ESMF.api.constants.PoleMethod"><code class="xref py py-class docutils literal notranslate"><span class="pre">PoleMethod</span></code></a></p></td>
<td><p>Specify which type of artificial pole to construct on the source <a class="reference internal" href="grid.html#ESMF.api.grid.Grid" title="ESMF.api.grid.Grid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Grid</span></code></a> for regridding</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="Region.html#ESMF.api.constants.Region" title="ESMF.api.constants.Region"><code class="xref py py-class docutils literal notranslate"><span class="pre">Region</span></code></a></p></td>
<td><p>Specify various regions in the data layout of</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="RegridMethod.html#ESMF.api.constants.RegridMethod" title="ESMF.api.constants.RegridMethod"><code class="xref py py-class docutils literal notranslate"><span class="pre">RegridMethod</span></code></a></p></td>
<td><p>Specify which interpolation method to use regridding</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="StaggerLoc.html#ESMF.api.constants.StaggerLoc" title="ESMF.api.constants.StaggerLoc"><code class="xref py py-class docutils literal notranslate"><span class="pre">StaggerLoc</span></code></a></p></td>
<td><p>Specify the position for data in a <a class="reference internal" href="grid.html#ESMF.api.grid.Grid" title="ESMF.api.grid.Grid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Grid</span></code></a> cell</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="TypeKind.html#ESMF.api.constants.TypeKind" title="ESMF.api.constants.TypeKind"><code class="xref py py-class docutils literal notranslate"><span class="pre">TypeKind</span></code></a></p></td>
<td><p>Specify the type and kind of data</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="UnmappedAction.html#ESMF.api.constants.UnmappedAction" title="ESMF.api.constants.UnmappedAction"><code class="xref py py-class docutils literal notranslate"><span class="pre">UnmappedAction</span></code></a></p></td>
<td><p>Specify which action to take with respect to unmapped destination points</p></td>
</tr>
</tbody>
</table>
</section>
<section id="manager">
<h2>Manager<a class="headerlink" href="#manager" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="manager.html#ESMF.api.esmpymanager.Manager" title="ESMF.api.esmpymanager.Manager"><code class="xref py py-class docutils literal notranslate"><span class="pre">Manager</span></code></a> is used by ESMPy to simplify a
number of low-level calls used by the underlying ESMF framework to allocate
resources, enable logging, and control garbage collection.</p>
<section id="resource-allocation">
<h3>Resource Allocation<a class="headerlink" href="#resource-allocation" title="Permalink to this headline">¶</a></h3>
<p>The ESMF Virtual Machine (VM)
is created at the beginning of each ESMPy execution, and contains information
about the topology and characteristics of the underlying computer. The VM
allocates computational resources in the form of
<strong>Persistent Execution Threads</strong>, or <strong>PETs</strong>. These are equivalent to operating
system threads with a lifetime of at least that of the ESMPy execution. In the
simplest, and most common case, a PET is equivalent to an MPI process. The
number of PETs and the current PET can be queried from the
<a class="reference internal" href="manager.html#ESMF.api.esmpymanager.Manager" title="ESMF.api.esmpymanager.Manager"><code class="xref py py-class docutils literal notranslate"><span class="pre">Manager</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mg</span> <span class="o">=</span> <span class="n">ESMF</span><span class="o">.</span><span class="n">Manager</span><span class="p">()</span>
<span class="n">pet_count</span> <span class="o">=</span> <span class="n">mg</span><span class="o">.</span><span class="n">pet_count</span><span class="p">()</span>
<span class="n">local_pet</span> <span class="o">=</span> <span class="n">mg</span><span class="o">.</span><span class="n">local_pet</span><span class="p">()</span>
</pre></div>
</div>
<p>Refer to the VM Class of the
<a class="reference external" href="http://earthsystemmodeling.org/docs/release/latest/ESMF_refdoc/">ESMF Reference Manual</a>
for more information.</p>
</section>
<section id="logging">
<h3>Logging<a class="headerlink" href="#logging" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="manager.html#ESMF.api.esmpymanager.Manager" title="ESMF.api.esmpymanager.Manager"><code class="xref py py-class docutils literal notranslate"><span class="pre">Manager</span></code></a> is also used to enable logging:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mg</span> <span class="o">=</span> <span class="n">ESMF</span><span class="o">.</span><span class="n">Manager</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">local_pet</span> <span class="o">=</span> <span class="n">mg</span><span class="o">.</span><span class="n">local_pet</span><span class="p">()</span>
</pre></div>
</div>
<p>The output will be logged in files named PET&lt;local_pet&gt;.ESMF_LogFile.</p>
</section>
<section id="garbage-collection">
<h3>Garbage Collection<a class="headerlink" href="#garbage-collection" title="Permalink to this headline">¶</a></h3>
<p>The underlying ESMF framework needs to be initialized and finalized once and
only once per execution. This is handled internally by the
<a class="reference internal" href="manager.html#ESMF.api.esmpymanager.Manager" title="ESMF.api.esmpymanager.Manager"><code class="xref py py-class docutils literal notranslate"><span class="pre">Manager</span></code></a> and <strong>does not</strong> require any explicit
user intervention. However, the ESMF garbage collection feature is not triggered
until the finalization routine is invoked. So if memory deallocation of ESMPy
objects is required <em>prior</em> to the end of the program, the class level
<code class="docutils literal notranslate"><span class="pre">destroy</span></code> routines should be invoked:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mg</span> <span class="o">=</span> <span class="n">ESMF</span><span class="o">.</span><span class="n">Manager</span><span class="p">()</span>

<span class="n">mg</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span>
</pre></div>
</div>
<p>This is commonly required when reusing a <a class="reference internal" href="regrid.html#ESMF.api.regrid.Regrid" title="ESMF.api.regrid.Regrid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Regrid</span></code></a> object
to interpolate data between many <a class="reference internal" href="field.html#ESMF.api.field.Field" title="ESMF.api.field.Field"><code class="xref py py-class docutils literal notranslate"><span class="pre">Field</span></code></a> pairs to
conserve memory to complete all interpolations in a single execution.</p>
</section>
<section id="moab-mesh-backend">
<h3>MOAB Mesh backend<a class="headerlink" href="#moab-mesh-backend" title="Permalink to this headline">¶</a></h3>
<p>The Manager can be used to enable the <a class="reference external" href="https://sigma.mcs.anl.gov/moab-library/">MOAB</a>
mesh backend to the Mesh. This is done by calling <code class="docutils literal notranslate"><span class="pre">set_moab()</span></code> with <code class="docutils literal notranslate"><span class="pre">moab_on=True</span></code>.
The MOAB mesh is an alternative to the native ESMF mesh, and does not yet have
full support.</p>
</section>
</section>
<section id="spatial-discretization-objects">
<h2>Spatial Discretization Objects<a class="headerlink" href="#spatial-discretization-objects" title="Permalink to this headline">¶</a></h2>
<p>There are three different objects used for spatial coordinate representation:
<a class="reference internal" href="grid.html#ESMF.api.grid.Grid" title="ESMF.api.grid.Grid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Grid</span></code></a>, <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a>, and <a class="reference internal" href="locstream.html#ESMF.api.locstream.LocStream" title="ESMF.api.locstream.LocStream"><code class="xref py py-class docutils literal notranslate"><span class="pre">LocStream</span></code></a>. <a class="reference internal" href="grid.html#ESMF.api.grid.Grid" title="ESMF.api.grid.Grid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Grids</span></code></a> are used to represent logically rectangular
grids, <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Meshes</span></code></a> are used for unstructured collections of polygons, and
<a class="reference internal" href="locstream.html#ESMF.api.locstream.LocStream" title="ESMF.api.locstream.LocStream"><code class="xref py py-class docutils literal notranslate"><span class="pre">LocStreams</span></code></a> are used for unstructured collections of individual points. These
objects are nearly identical counterparts to the objects of the same name in
ESMF, with some simplifications for ease of use in the Python environment.</p>
<section id="grid">
<h3>Grid<a class="headerlink" href="#grid" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="grid.html#ESMF.api.grid.Grid" title="ESMF.api.grid.Grid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Grid</span></code></a> is used to represent the geometry and discretization of logically
rectangular physical grids. The <a class="reference internal" href="grid.html#ESMF.api.grid.Grid" title="ESMF.api.grid.Grid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Grid</span></code></a> can also hold information that can used in
calculations involving the <a class="reference internal" href="grid.html#ESMF.api.grid.Grid" title="ESMF.api.grid.Grid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Grid</span></code></a>, like a mask or the cell areas. Refer to the Grid Class of the
<a class="reference external" href="http://earthsystemmodeling.org/docs/release/latest/ESMF_refdoc/">ESMF Reference Manual</a> for more information.</p>
<section id="staggering">
<h4>Staggering<a class="headerlink" href="#staggering" title="Permalink to this headline">¶</a></h4>
<p>Staggering is a finite difference technique in which the values of different
physical quantities are placed at different locations within a grid cell.</p>
<p>The ESMF <a class="reference internal" href="grid.html#ESMF.api.grid.Grid" title="ESMF.api.grid.Grid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Grid</span></code></a> class supports a variety of stagger locations, including cell
centers, corners, and edge centers. The default stagger location in ESMF is the
cell center, and cell counts in <a class="reference internal" href="grid.html#ESMF.api.grid.Grid" title="ESMF.api.grid.Grid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Grid</span></code></a> are based on this assumption. Combinations
of the 2D ESMF stagger locations are sufficient to specify any of the Arakawa
staggers. ESMF also supports staggering in 3D and higher dimensions. There are
shortcuts for standard staggers, and interfaces through which users can create
custom staggers.</p>
<p>As a default the ESMF <a class="reference internal" href="grid.html#ESMF.api.grid.Grid" title="ESMF.api.grid.Grid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Grid</span></code></a> class provides symmetric staggering, so that cell
centers are enclosed by cell perimeter (e.g. corner) stagger locations. This
means the coordinate arrays for stagger locations other than the center will
have an additional element of padding in order to enclose the cell center
locations. However, to achieve other types of staggering, the user may alter or
eliminate this padding by using the appropriate options when adding coordinates
to a <a class="reference internal" href="grid.html#ESMF.api.grid.Grid" title="ESMF.api.grid.Grid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Grid</span></code></a>.</p>
<p><a class="reference internal" href="grid.html#ESMF.api.grid.Grid" title="ESMF.api.grid.Grid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Grid</span></code></a> staggers are indicated using
<a class="reference internal" href="StaggerLoc.html#ESMF.api.constants.StaggerLoc" title="ESMF.api.constants.StaggerLoc"><code class="xref py py-class docutils literal notranslate"><span class="pre">StaggerLoc</span></code></a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">grid</span> <span class="o">=</span> <span class="n">ESMF</span><span class="o">.</span><span class="n">Grid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]),</span> <span class="n">staggerloc</span><span class="o">=</span><span class="n">ESMF</span><span class="o">.</span><span class="n">StaggerLoc</span><span class="o">.</span><span class="n">CENTER</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="spherical-coordinates">
<h4>Spherical Coordinates<a class="headerlink" href="#spherical-coordinates" title="Permalink to this headline">¶</a></h4>
<p>In the case that the <a class="reference internal" href="grid.html#ESMF.api.grid.Grid" title="ESMF.api.grid.Grid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Grid</span></code></a> is on a sphere (coord_sys = <a class="reference internal" href="CoordSys.html#ESMF.api.constants.CoordSys.SPH_DEG" title="ESMF.api.constants.CoordSys.SPH_DEG"><code class="xref py py-class docutils literal notranslate"><span class="pre">ESMF.api.constants.CoordSys.SPH_DEG</span></code></a> or
<a class="reference internal" href="CoordSys.html#ESMF.api.constants.CoordSys.SPH_RAD" title="ESMF.api.constants.CoordSys.SPH_RAD"><code class="xref py py-class docutils literal notranslate"><span class="pre">ESMF.api.constants.CoordSys.SPH_RAD</span></code></a>) then the coordinates given in the <a class="reference internal" href="grid.html#ESMF.api.grid.Grid" title="ESMF.api.grid.Grid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Grid</span></code></a> are interpreted
as latitude and longitude values. The coordinates can either be in degrees or
radians as indicated by the <code class="docutils literal notranslate"><span class="pre">coord_sys</span></code> flag set during <a class="reference internal" href="grid.html#ESMF.api.grid.Grid" title="ESMF.api.grid.Grid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Grid</span></code></a> creation. As is
true with many global models, this application currently assumes the latitude
and longitude refer to positions on a perfect sphere.</p>
<p>The <a class="reference internal" href="grid.html#ESMF.api.grid.Grid" title="ESMF.api.grid.Grid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Grid</span></code></a> coordinate system is represented using
<a class="reference internal" href="CoordSys.html#ESMF.api.constants.CoordSys" title="ESMF.api.constants.CoordSys"><code class="xref py py-class docutils literal notranslate"><span class="pre">CoordSys</span></code></a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">grid</span> <span class="o">=</span> <span class="n">ESMF</span><span class="o">.</span><span class="n">Grid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]),</span> <span class="n">staggerloc</span><span class="o">=</span><span class="n">ESMF</span><span class="o">.</span><span class="n">StaggerLoc</span><span class="o">.</span><span class="n">CENTER</span><span class="p">,</span>
                    <span class="n">coord_sys</span><span class="o">=</span><span class="n">ESMF</span><span class="o">.</span><span class="n">CoordSys</span><span class="o">.</span><span class="n">SPH_DEG</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="periodicity">
<h4>Periodicity<a class="headerlink" href="#periodicity" title="Permalink to this headline">¶</a></h4>
<p>A periodic connection can be specified when building <a class="reference internal" href="grid.html#ESMF.api.grid.Grid" title="ESMF.api.grid.Grid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Grids</span></code></a> in spherical
coordinates. The <code class="docutils literal notranslate"><span class="pre">num_peri_dims</span></code> parameter indicates the total number of
periodic dimensions and <code class="docutils literal notranslate"><span class="pre">periodic_dim</span></code> is used to identify which dimensions
should be considered periodic. There must always be at least one non-periodic
dimension. For example, to create a global latitude-longitude <a class="reference internal" href="grid.html#ESMF.api.grid.Grid" title="ESMF.api.grid.Grid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Grid</span></code></a> there would
be one periodic dimension, dimension 0 (longitude).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">grid</span> <span class="o">=</span> <span class="n">ESMF</span><span class="o">.</span><span class="n">Grid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]),</span> <span class="n">staggerloc</span><span class="o">=</span><span class="n">ESMF</span><span class="o">.</span><span class="n">StaggerLoc</span><span class="o">.</span><span class="n">CENTER</span><span class="p">,</span>
                    <span class="n">coord_sys</span><span class="o">=</span><span class="n">ESMF</span><span class="o">.</span><span class="n">CoordSys</span><span class="o">.</span><span class="n">SPH_DEG</span><span class="p">,</span>
                    <span class="n">num_peri_dims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">periodic_dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="pole-generation">
<h4>Pole Generation<a class="headerlink" href="#pole-generation" title="Permalink to this headline">¶</a></h4>
<p>The <a class="reference internal" href="grid.html#ESMF.api.grid.Grid" title="ESMF.api.grid.Grid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Grid</span></code></a> can generate an artificial pole by using the <code class="docutils literal notranslate"><span class="pre">pole_dim</span></code> parameter. This
can be helpful for regridding operations to smooth out the interpolated values
in the polar region. For the example of creating a global latitude-longitude
<a class="reference internal" href="grid.html#ESMF.api.grid.Grid" title="ESMF.api.grid.Grid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Grid</span></code></a>, the pole dimension would be 1 (latitude).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">grid</span> <span class="o">=</span> <span class="n">ESMF</span><span class="o">.</span><span class="n">Grid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]),</span> <span class="n">staggerloc</span><span class="o">=</span><span class="n">ESMF</span><span class="o">.</span><span class="n">StaggerLoc</span><span class="o">.</span><span class="n">CENTER</span><span class="p">,</span>
                    <span class="n">coord_sys</span><span class="o">=</span><span class="n">ESMF</span><span class="o">.</span><span class="n">CoordSys</span><span class="o">.</span><span class="n">SPH_DEG</span><span class="p">,</span>
                    <span class="n">num_peri_dims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">periodic_dim</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">pole_dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="masking">
<h4>Masking<a class="headerlink" href="#masking" title="Permalink to this headline">¶</a></h4>
<p>Masking is the process used to mark parts of a <a class="reference internal" href="grid.html#ESMF.api.grid.Grid" title="ESMF.api.grid.Grid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Grid</span></code></a> to be ignored during an
operation. Marking <a class="reference internal" href="grid.html#ESMF.api.grid.Grid" title="ESMF.api.grid.Grid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Grid</span></code></a> cells as masked can affect the <a class="reference internal" href="field.html#ESMF.api.field.Field" title="ESMF.api.field.Field"><code class="xref py py-class docutils literal notranslate"><span class="pre">Field</span></code></a> values that are
represented by those cells. Masking is specified by assigning an integer value
to a <a class="reference internal" href="grid.html#ESMF.api.grid.Grid" title="ESMF.api.grid.Grid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Grid</span></code></a> cell. This allows many different masks to be defined on the same <a class="reference internal" href="grid.html#ESMF.api.grid.Grid" title="ESMF.api.grid.Grid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Grid</span></code></a>,
any combination of which may be also activated on the <a class="reference internal" href="field.html#ESMF.api.field.Field" title="ESMF.api.field.Field"><code class="xref py py-class docutils literal notranslate"><span class="pre">Field</span></code></a> by specifying the
corresponding integer values. The activation of <a class="reference internal" href="field.html#ESMF.api.field.Field" title="ESMF.api.field.Field"><code class="xref py py-class docutils literal notranslate"><span class="pre">Field</span></code></a> masks with respect to the
underlying <a class="reference internal" href="grid.html#ESMF.api.grid.Grid" title="ESMF.api.grid.Grid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Grid</span></code></a> mask is handled by <a class="reference internal" href="regrid.html#ESMF.api.regrid.Regrid" title="ESMF.api.regrid.Regrid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Regrid</span></code></a>, and a more
general discussion of masking is covered in the <a class="reference internal" href="#id16"><span class="std std-ref">masking</span></a>
section.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
   <span class="o">...</span><span class="p">:</span> <span class="kn">import</span> <span class="nn">ESMF</span>
   <span class="o">...</span><span class="p">:</span> <span class="n">grid</span> <span class="o">=</span> <span class="n">ESMF</span><span class="o">.</span><span class="n">Grid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]),</span> <span class="n">staggerloc</span><span class="o">=</span><span class="n">ESMF</span><span class="o">.</span><span class="n">StaggerLoc</span><span class="o">.</span><span class="n">CENTER</span><span class="p">,</span>
   <span class="o">...</span><span class="p">:</span>                                <span class="n">coord_sys</span><span class="o">=</span><span class="n">ESMF</span><span class="o">.</span><span class="n">CoordSys</span><span class="o">.</span><span class="n">SPH_DEG</span><span class="p">,</span>
   <span class="o">...</span><span class="p">:</span>                                <span class="n">num_peri_dims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">periodic_dim</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">pole_dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="n">ESMF</span><span class="o">.</span><span class="n">GridItem</span><span class="o">.</span><span class="n">MASK</span><span class="p">,</span> <span class="n">staggerloc</span><span class="o">=</span><span class="n">ESMF</span><span class="o">.</span><span class="n">StaggerLoc</span><span class="o">.</span><span class="n">CENTER</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span> <span class="n">mask</span>
   <span class="o">...</span><span class="p">:</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
<span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">int32</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="cell-areas">
<h4>Cell Areas<a class="headerlink" href="#cell-areas" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="grid.html#ESMF.api.grid.Grid" title="ESMF.api.grid.Grid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Grid</span></code></a> cell areas can be calculated by ESMPy. Space must first be allocated for
this calculation by adding an
<a class="reference internal" href="GridItem.html#ESMF.api.constants.GridItem.AREA" title="ESMF.api.constants.GridItem.AREA"><code class="xref py py-class docutils literal notranslate"><span class="pre">AREA</span></code></a> item to the <a class="reference internal" href="grid.html#ESMF.api.grid.Grid" title="ESMF.api.grid.Grid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Grid</span></code></a>.
Then a <a class="reference internal" href="field.html#ESMF.api.field.Field" title="ESMF.api.field.Field"><code class="xref py py-class docutils literal notranslate"><span class="pre">Field</span></code></a> must be created, and the
<a class="reference internal" href="field.html#ESMF.api.field.Field.get_area" title="ESMF.api.field.Field.get_area"><code class="xref py py-class docutils literal notranslate"><span class="pre">get_area()</span></code></a> function called.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <a class="reference internal" href="grid.html#ESMF.api.grid.Grid" title="ESMF.api.grid.Grid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Grid</span></code></a> area calculation assumes the <a class="reference internal" href="grid.html#ESMF.api.grid.Grid" title="ESMF.api.grid.Grid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Grid</span></code></a> is a unit sphere.</p>
</div>
<p><a class="reference internal" href="grid.html#ESMF.api.grid.Grid" title="ESMF.api.grid.Grid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Grid</span></code></a> cell areas may also be set to user-defined values
after the <a class="reference internal" href="GridItem.html#ESMF.api.constants.GridItem.AREA" title="ESMF.api.constants.GridItem.AREA"><code class="xref py py-class docutils literal notranslate"><span class="pre">AREA</span></code></a> item has
been allocated and retrieved using <a class="reference internal" href="grid.html#ESMF.api.grid.Grid.get_item" title="ESMF.api.grid.Grid.get_item"><code class="xref py py-class docutils literal notranslate"><span class="pre">get_item()</span></code></a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">grid</span> <span class="o">=</span> <span class="n">ESMF</span><span class="o">.</span><span class="n">Grid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]),</span> <span class="n">staggerloc</span><span class="o">=</span><span class="p">[</span><span class="n">ESMF</span><span class="o">.</span><span class="n">StaggerLoc</span><span class="o">.</span><span class="n">CENTER</span><span class="p">,</span> <span class="n">ESMF</span><span class="o">.</span><span class="n">StaggerLoc</span><span class="o">.</span><span class="n">CORNER</span><span class="p">],</span>
   <span class="o">...</span><span class="p">:</span>                  <span class="n">coord_sys</span><span class="o">=</span><span class="n">ESMF</span><span class="o">.</span><span class="n">CoordSys</span><span class="o">.</span><span class="n">SPH_DEG</span><span class="p">,</span>
   <span class="o">...</span><span class="p">:</span>                  <span class="n">num_peri_dims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">periodic_dim</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">pole_dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span> <span class="n">gridLon</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">get_coords</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span> <span class="n">gridLat</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">get_coords</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span> <span class="n">gridLonCorner</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">get_coords</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">staggerloc</span><span class="o">=</span><span class="n">ESMF</span><span class="o">.</span><span class="n">StaggerLoc</span><span class="o">.</span><span class="n">CORNER</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span> <span class="n">gridLatCorner</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">get_coords</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">staggerloc</span><span class="o">=</span><span class="n">ESMF</span><span class="o">.</span><span class="n">StaggerLoc</span><span class="o">.</span><span class="n">CORNER</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span> <span class="n">lon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">120</span><span class="p">,</span><span class="mi">120</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span> <span class="n">lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">67.5</span><span class="p">,</span> <span class="mf">67.5</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span> <span class="n">lon_corner</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span><span class="mi">180</span><span class="p">,</span><span class="mi">120</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span> <span class="n">lat_corner</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span> <span class="n">lonm</span><span class="p">,</span> <span class="n">latm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s1">&#39;ij&#39;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span> <span class="n">lonm_corner</span><span class="p">,</span> <span class="n">latm_corner</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">lon_corner</span><span class="p">,</span> <span class="n">lat_corner</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s1">&#39;ij&#39;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span> <span class="n">gridLon</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">lonm</span>
   <span class="o">...</span><span class="p">:</span> <span class="n">gridLat</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">latm</span>
   <span class="o">...</span><span class="p">:</span> <span class="n">gridLonCorner</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">lonm_corner</span>
   <span class="o">...</span><span class="p">:</span> <span class="n">gridLatCorner</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">latm_corner</span>
   <span class="o">...</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span> <span class="n">field</span> <span class="o">=</span> <span class="n">ESMF</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span> <span class="n">field</span><span class="o">.</span><span class="n">get_area</span><span class="p">()</span>
   <span class="o">...</span><span class="p">:</span> <span class="n">field</span><span class="o">.</span><span class="n">data</span>
   <span class="o">...</span><span class="p">:</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
<span class="n">array</span><span class="p">([[</span> <span class="mf">0.32224085</span><span class="p">,</span>  <span class="mf">1.02707409</span><span class="p">,</span>  <span class="mf">1.02707409</span><span class="p">,</span>  <span class="mf">0.32224085</span><span class="p">],</span>
       <span class="p">[</span> <span class="mf">0.32224085</span><span class="p">,</span>  <span class="mf">1.02707409</span><span class="p">,</span>  <span class="mf">1.02707409</span><span class="p">,</span>  <span class="mf">0.32224085</span><span class="p">],</span>
       <span class="p">[</span> <span class="mf">0.32224085</span><span class="p">,</span>  <span class="mf">1.02707409</span><span class="p">,</span>  <span class="mf">1.02707409</span><span class="p">,</span>  <span class="mf">0.32224085</span><span class="p">]])</span>
</pre></div>
</div>
</section>
</section>
<section id="mesh">
<h3>Mesh<a class="headerlink" href="#mesh" title="Permalink to this headline">¶</a></h3>
<p>A <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a> is an object for representing unstructured grids.
Refer to the Mesh Class of the
<a class="reference external" href="http://earthsystemmodeling.org/docs/release/latest/ESMF_refdoc/">ESMF Reference Manual</a>
for more information.</p>
<p>A <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a> is constructed of <em>nodes</em> and <em>elements</em>. A node, also known as a vertex
or corner, is a part of a <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a> which represents a single point. An element,
also known as a cell, is a part of a <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a> which represents a small
region of space. Elements are described in terms of a connected set of nodes
which represent locations along their boundaries.</p>
<p><a class="reference internal" href="field.html#ESMF.api.field.Field" title="ESMF.api.field.Field"><code class="xref py py-class docutils literal notranslate"><span class="pre">Field</span></code></a> data may be located on either the nodes or elements of a <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a>. <a class="reference internal" href="field.html#ESMF.api.field.Field" title="ESMF.api.field.Field"><code class="xref py py-class docutils literal notranslate"><span class="pre">Fields</span></code></a>
created on a <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a> can also be used as either the source or destination or both
of a regridding operation.</p>
<p>The dimension of a <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a> in ESMF is specified with two parameters: the
<em>parametric</em> dimension and the <em>spatial</em> dimension.</p>
<p>The parametric dimension of a <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a> is the dimension of the topology of the <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a>.
This can be thought of as the dimension of the elements which make up the <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a>.
For example, a <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a> composed of triangles would have a parametric dimension of
2, and a <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a> composed of tetrahedra would have a parametric dimension of 3.</p>
<p>The spatial dimension of a <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a> is the dimension of the space in which the <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a>
is embedded. In other words, it is the number of coordinate dimensions needed to
describe the location of the nodes making up the <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a>.</p>
<p>For example, a <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a> constructed of squares on a plane would have a parametric
dimension of 2 and a spatial dimension of 2. If that same <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a> were used to
represent the 2D surface of a sphere, then the <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a> would still have a
parametric dimension of 2, but now its spatial dimension would be 3.</p>
<p>Only <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Meshes</span></code></a> whose number of coordinate dimensions (spatial dimension) is 2 or 3
are supported. The dimension of the elements in a <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a> (parametric dimension) must
be less than or equal to the spatial dimension, but also must be either 2 or 3.
This means that a <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a> may be either 2D elements in 2D space, 3D elements in 3D
space, or a manifold constructed of 2D elements embedded in 3D space.</p>
<p>For a parametric dimension of 2, the native supported element types are
triangles and quadrilaterals. In addition to these, ESMF supports 2D polygons
with any number of sides. Internally these are represented as sets of triangles,
but to the user should behave like any other element. For a parametric dimension
of 3, the supported element types are tetrahedrons and hexahedrons. The <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a>
supports any combination of element types within a particular dimension, but
types from different dimensions may not be mixed. For example, a <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a> cannot be
constructed of both quadrilaterals and tetrahedra.</p>
<section id="mesh-creation">
<h4>Mesh Creation<a class="headerlink" href="#mesh-creation" title="Permalink to this headline">¶</a></h4>
<p>To create a <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a> we need to set some properties of the <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a> as a whole, some
properties of each node in the <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a> and then some properties of each element
which connects the nodes.</p>
<p>For the <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a> as a whole we set its parametric dimension and spatial dimension.
A <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh's</span></code></a> parametric dimension can be thought of as the dimension of the elements
which make up the <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a>. A <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh's</span></code></a> spatial dimension, on the other hand, is the
number of coordinate dimensions needed to describe the location of the nodes
making up the <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a>.</p>
<p>The structure of the per node and element information used to create a <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a> is
influenced by the <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a> distribution strategy. The <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a> class is distributed by
elements. This means that a node must be present on any PET that contains
an element associated with that node, but not on any other PET (a node
can’t be on a PET without an element “home”). Since a node may be used by
two or more elements located on different PETs, a node may be duplicated
on multiple PETs. When a node is duplicated in this manner, one and only
one of the PETs that contain the node must “own” the node. The user sets
this ownership when they define the nodes during <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a>
creation. When a <a class="reference internal" href="field.html#ESMF.api.field.Field" title="ESMF.api.field.Field"><code class="xref py py-class docutils literal notranslate"><span class="pre">Field</span></code></a> is created on a
<a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a> (i.e. on the <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a> nodes),
on each PET the <a class="reference internal" href="field.html#ESMF.api.field.Field" title="ESMF.api.field.Field"><code class="xref py py-class docutils literal notranslate"><span class="pre">Field</span></code></a> is only
created on the nodes which are owned by that PET. This means that the size
of the <a class="reference internal" href="field.html#ESMF.api.field.Field" title="ESMF.api.field.Field"><code class="xref py py-class docutils literal notranslate"><span class="pre">Field</span></code></a> memory on the PET can be smaller than the
number of nodes used to create the <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a> on that PET.</p>
<p>Three properties need to be defined for each <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a> node: the global id of the node
(<code class="docutils literal notranslate"><span class="pre">node_ids</span></code>), node coordinates (<code class="docutils literal notranslate"><span class="pre">node_coords</span></code>), and which PET owns the node
(<code class="docutils literal notranslate"><span class="pre">node_owners</span></code>). The node id is a unique (across all PETs) integer attached
to the particular node. It is used to indicate which nodes are the same when
connecting together pieces of the <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a> on different PETs. The node
coordinates indicate the location of a node in space and are used in the <a class="reference internal" href="regrid.html#ESMF.api.regrid.Regrid" title="ESMF.api.regrid.Regrid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Regrid</span></code></a>
functionality when interpolating. The node owner indicates which PET is in
charge of the node. This is used when creating a <a class="reference internal" href="field.html#ESMF.api.field.Field" title="ESMF.api.field.Field"><code class="xref py py-class docutils literal notranslate"><span class="pre">Field</span></code></a> on the <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a> to indicate
which PET should contain a <a class="reference internal" href="field.html#ESMF.api.field.Field" title="ESMF.api.field.Field"><code class="xref py py-class docutils literal notranslate"><span class="pre">Field</span></code></a> location for the data.</p>
<p>Three properties need to be defined for each <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a> element: the global id of the
element (<code class="docutils literal notranslate"><span class="pre">element_ids</span></code>), the topology type of the element (<code class="docutils literal notranslate"><span class="pre">element_types</span></code>), and
which nodes are connected together to form the element (<code class="docutils literal notranslate"><span class="pre">element_conn</span></code>). The
element id is a unique (across all PETs) integer attached to the
particular element. The element type describes the topology of the element
(e.g. a triangle vs. a quadrilateral). The range of choices for the topology of
the elements in a <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a> are restricted by the <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh's</span></code></a> parametric dimension (e.g. a
<a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a> can’t contain a 2D element like a triangle, when its parametric dimension
is 3D), but it can contain any combination of elements appropriate to its
dimension. In particular, in 2D ESMF supports two native element types triangle
and quadrilateral, but also provides support for polygons with any number of
sides. These polygons are represented internally as sets of triangles, but to
the user should behave like other elements. To specify a polygon with more than
four sides, the element type should be set to the number of corners of the
polygon (e.g. element type=6 for a hexagon). The element connectivity indicates
which nodes are to be connected together to form the element. The number of
nodes connected together for each element is implied by the elements topology
type (<code class="docutils literal notranslate"><span class="pre">element_types</span></code>). It is IMPORTANT to note, that the entries in this list are
NOT the global ids of the nodes, but are indices into the PET local lists
of node info used in the <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a> creation. In other words, the element connectivity
isn’t specified in terms of the global list of nodes, but instead is specified
in terms of the locally described node info. One other important point about
connectivities is that the order of the nodes in the connectivity list of an
element is important. In general, when specifying an element with parametric
dimension 2, the nodes should be given in counterclockwise order around the
element.</p>
<p>The three step <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a> creation process starts with a call to the <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a> constructor.
It is then followed by the <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh.add_nodes" title="ESMF.api.mesh.Mesh.add_nodes"><code class="xref py py-class docutils literal notranslate"><span class="pre">add_nodes()</span></code></a> call to
specify nodes, and then the <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh.add_elements" title="ESMF.api.mesh.Mesh.add_elements"><code class="xref py py-class docutils literal notranslate"><span class="pre">add_elements()</span></code></a> call to
specify elements.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#  2.5        8        10 --------11</span>
<span class="c1">#          /     \   /            |</span>
<span class="c1">#  2.1   7         9              12</span>
<span class="c1">#        |         |      5       /</span>
<span class="c1">#        |    4    |            /</span>
<span class="c1">#        |         |          /</span>
<span class="c1">#  1.0   4 ------- 5 ------- 6</span>
<span class="c1">#        |         |  \   3  |</span>
<span class="c1">#        |    1    |    \    |</span>
<span class="c1">#        |         |  2   \  |</span>
<span class="c1"># -0.1   1 ------- 2 ------- 3</span>
<span class="c1">#</span>
<span class="c1">#      -0.1       1.0       2.1   2.5</span>
<span class="c1">#</span>
<span class="c1">#          Node Ids at corners</span>
<span class="c1">#          Element Ids in centers</span>

<span class="c1"># Two parametric dimensions, and two spatial dimensions</span>
<span class="n">mesh</span> <span class="o">=</span> <span class="n">ESMF</span><span class="o">.</span><span class="n">Mesh</span><span class="p">(</span><span class="n">parametric_dim</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">spatial_dim</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">coord_sys</span><span class="o">=</span><span class="n">coord_sys</span><span class="p">)</span>

<span class="n">num_node</span> <span class="o">=</span> <span class="mi">12</span>
<span class="n">num_elem</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">nodeId</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">])</span>
<span class="n">nodeCoord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span>  <span class="c1">#node id 1</span>
                      <span class="mf">1.0</span><span class="p">,</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span>  <span class="c1">#node id 2</span>
                      <span class="mf">2.1</span><span class="p">,</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span>  <span class="c1">#node id 3</span>
                      <span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>  <span class="c1">#node id 4</span>
                      <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>  <span class="c1">#node id 5</span>
                      <span class="mf">2.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>  <span class="c1">#node id 6</span>
                      <span class="mf">0.1</span><span class="p">,</span> <span class="mf">2.1</span><span class="p">,</span>  <span class="c1">#node id 7</span>
                      <span class="mf">0.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span>  <span class="c1">#node id 8</span>
                      <span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.1</span><span class="p">,</span>  <span class="c1">#node id 9</span>
                      <span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span>  <span class="c1">#node id 10</span>
                      <span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span>  <span class="c1">#node id 11</span>
                      <span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.1</span><span class="p">])</span> <span class="c1">#node id 12</span>


<span class="n">nodeOwner</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_node</span><span class="p">)</span>

<span class="n">elemId</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span>
<span class="n">elemType</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ESMF</span><span class="o">.</span><span class="n">MeshElemType</span><span class="o">.</span><span class="n">QUAD</span><span class="p">,</span>
                   <span class="n">ESMF</span><span class="o">.</span><span class="n">MeshElemType</span><span class="o">.</span><span class="n">TRI</span><span class="p">,</span>
                   <span class="n">ESMF</span><span class="o">.</span><span class="n">MeshElemType</span><span class="o">.</span><span class="n">TRI</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>

<span class="n">elemConn</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span>         <span class="c1"># elem id 1</span>
                   <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span>           <span class="c1"># elem id 2</span>
                   <span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span>           <span class="c1"># elem id 3</span>
                   <span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span>       <span class="c1"># elem id 4</span>
                   <span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">8</span><span class="p">])</span>  <span class="c1"># elem id 5</span>

<span class="n">mesh</span><span class="o">.</span><span class="n">add_nodes</span><span class="p">(</span><span class="n">num_node</span><span class="p">,</span><span class="n">nodeId</span><span class="p">,</span><span class="n">nodeCoord</span><span class="p">,</span><span class="n">nodeOwner</span><span class="p">)</span>

<span class="n">mesh</span><span class="o">.</span><span class="n">add_elements</span><span class="p">(</span><span class="n">num_elem</span><span class="p">,</span><span class="n">elemId</span><span class="p">,</span><span class="n">elemType</span><span class="p">,</span><span class="n">elemConn</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id3">
<h4>Masking<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<p>There are two types of masking available in <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a>: node masking and element
masking. These both work in a similar manner, but vary slightly in the details
of setting the mask information during <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a> creation.</p>
<p>For node masking, the mask information is set using the <code class="docutils literal notranslate"><span class="pre">node_mask</span></code> parameter.
When a <a class="reference internal" href="regrid.html#ESMF.api.regrid.Regrid" title="ESMF.api.regrid.Regrid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Regrid</span></code></a> object is created the mask values arguments <code class="docutils literal notranslate"><span class="pre">src_mask_values</span></code> and
<code class="docutils literal notranslate"><span class="pre">dst_mask_values</span></code> can then be used to indicate which particular values set in
the <code class="docutils literal notranslate"><span class="pre">node_mask</span></code> array indicate that the node should be masked. For example, if
<code class="docutils literal notranslate"><span class="pre">dst_mask_values</span></code> has been set to 1, then any node in the destination <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a> whose
corresponding <code class="docutils literal notranslate"><span class="pre">node_mask</span></code> value is 1 will be masked out (a node with any other
value than 1 will not be masked).</p>
<p>For element masking, the mask information is set using the <code class="docutils literal notranslate"><span class="pre">element_mask</span></code>
parameter when adding elements to the <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a>. In a similar manner to node masking,
the mask values parameters to <a class="reference internal" href="regrid.html#ESMF.api.regrid.Regrid" title="ESMF.api.regrid.Regrid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Regrid</span></code></a>, <code class="docutils literal notranslate"><span class="pre">src_mask_values</span></code> and <code class="docutils literal notranslate"><span class="pre">dst_mask_values</span></code>
can then be used to indicate which particular values set in the <code class="docutils literal notranslate"><span class="pre">element_mask</span></code>
array indicate that the element should be masked. For example, if
<code class="docutils literal notranslate"><span class="pre">dst_mask_values</span></code> has been set to 1, then any element in the destination <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a>
whose corresponding <code class="docutils literal notranslate"><span class="pre">element_mask</span></code> value is 1 will be masked out (an element
with any other value than 1 will not be masked).</p>
</section>
<section id="areas">
<h4>Areas<a class="headerlink" href="#areas" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a> cell areas can be specified using the <code class="docutils literal notranslate"><span class="pre">element_areas</span></code> parameter to
<a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh.add_elements" title="ESMF.api.mesh.Mesh.add_elements"><code class="xref py py-class docutils literal notranslate"><span class="pre">add_elements()</span></code></a>.</p>
<p>If cell areas are not specified by the user they can be calculated by ESMPy
using <a class="reference internal" href="field.html#ESMF.api.field.Field.get_area" title="ESMF.api.field.Field.get_area"><code class="xref py py-class docutils literal notranslate"><span class="pre">get_area()</span></code></a>.</p>
</section>
</section>
<section id="locstream">
<h3>LocStream<a class="headerlink" href="#locstream" title="Permalink to this headline">¶</a></h3>
<p>A <a class="reference internal" href="locstream.html#ESMF.api.locstream.LocStream" title="ESMF.api.locstream.LocStream"><code class="xref py py-class docutils literal notranslate"><span class="pre">LocStream</span></code></a> can be used to represent the locations of a set of
data points. For example, in the data assimilation world, <a class="reference internal" href="locstream.html#ESMF.api.locstream.LocStream" title="ESMF.api.locstream.LocStream"><code class="xref py py-class docutils literal notranslate"><span class="pre">LocStreams</span></code></a> can be used
to represent a set of observations. The values of the data points are stored
within a <a class="reference internal" href="field.html#ESMF.api.field.Field" title="ESMF.api.field.Field"><code class="xref py py-class docutils literal notranslate"><span class="pre">Field</span></code></a> created using the <a class="reference internal" href="locstream.html#ESMF.api.locstream.LocStream" title="ESMF.api.locstream.LocStream"><code class="xref py py-class docutils literal notranslate"><span class="pre">LocStream</span></code></a>.
Refer to the LocStream Class of the
<a class="reference external" href="http://earthsystemmodeling.org/docs/release/latest/ESMF_refdoc/">ESMF Reference Manual</a>
for more information.</p>
<p>The locations are generally described using Cartesian (x, y, z), or
(lat, lon, radius) coordinates. The coordinates are stored using constructs
called <em>keys</em>. A key is essentially a list of point descriptors, one for each data
point. They may hold other information besides the coordinates - a mask, for
example. They may also hold a second set of coordinates. Keys are referenced by
name. Each key must contain the same number of elements as there are data points
in the <a class="reference internal" href="locstream.html#ESMF.api.locstream.LocStream" title="ESMF.api.locstream.LocStream"><code class="xref py py-class docutils literal notranslate"><span class="pre">LocStream</span></code></a>. While there is no assumption in the ordering of the points,
the order chosen must be maintained in each of the keys.</p>
<p>A <a class="reference internal" href="locstream.html#ESMF.api.locstream.LocStream" title="ESMF.api.locstream.LocStream"><code class="xref py py-class docutils literal notranslate"><span class="pre">LocStream</span></code></a> can be very large. Data assimilation systems might use <a class="reference internal" href="locstream.html#ESMF.api.locstream.LocStream" title="ESMF.api.locstream.LocStream"><code class="xref py py-class docutils literal notranslate"><span class="pre">LocStreams</span></code></a>
with up to <span class="math">10^8</span> observations, so efficiency is critical. <a class="reference internal" href="locstream.html#ESMF.api.locstream.LocStream" title="ESMF.api.locstream.LocStream"><code class="xref py py-class docutils literal notranslate"><span class="pre">LocStreams</span></code></a> can be
created from file.</p>
<p>A <a class="reference internal" href="locstream.html#ESMF.api.locstream.LocStream" title="ESMF.api.locstream.LocStream"><code class="xref py py-class docutils literal notranslate"><span class="pre">LocStream</span></code></a> is similar to a <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a> in that both are collections of irregularly
positioned points. However, the two structures differ because a <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a> also has
connectivity: each data point represents either a center or corner of a cell.
There is no requirement that the points in a <a class="reference internal" href="locstream.html#ESMF.api.locstream.LocStream" title="ESMF.api.locstream.LocStream"><code class="xref py py-class docutils literal notranslate"><span class="pre">LocStream</span></code></a> have connectivity, in
fact there is no requirement that any two points have any particular spatial
relationship at all.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">locstream</span> <span class="o">=</span> <span class="n">ESMF</span><span class="o">.</span><span class="n">LocStream</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="n">coord_sys</span><span class="o">=</span><span class="n">coord_sys</span><span class="p">)</span>

<span class="n">deg_rad</span> <span class="o">=</span> <span class="n">pi</span>
<span class="k">if</span> <span class="n">coord_sys</span> <span class="o">==</span> <span class="n">ESMF</span><span class="o">.</span><span class="n">CoordSys</span><span class="o">.</span><span class="n">SPH_DEG</span><span class="p">:</span>
    <span class="n">deg_rad</span> <span class="o">=</span> <span class="mi">180</span>

<span class="n">locstream</span><span class="p">[</span><span class="s2">&quot;ESMF:Lon&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">deg_rad</span><span class="p">,</span> <span class="mf">1.5</span><span class="o">*</span><span class="n">deg_rad</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">deg_rad</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">deg_rad</span><span class="p">,</span> <span class="mf">1.5</span><span class="o">*</span><span class="n">deg_rad</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">deg_rad</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">deg_rad</span><span class="p">,</span> <span class="mf">1.5</span><span class="o">*</span><span class="n">deg_rad</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">deg_rad</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">deg_rad</span><span class="p">,</span> <span class="mf">1.5</span><span class="o">*</span><span class="n">deg_rad</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">deg_rad</span><span class="p">]</span>
<span class="n">locstream</span><span class="p">[</span><span class="s2">&quot;ESMF:Lat&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">deg_rad</span><span class="o">/-</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">deg_rad</span><span class="o">/-</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">deg_rad</span><span class="o">/-</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">deg_rad</span><span class="o">/-</span><span class="mf">2.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.25</span><span class="o">*</span><span class="n">deg_rad</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.25</span><span class="o">*</span><span class="n">deg_rad</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.25</span><span class="o">*</span><span class="n">deg_rad</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.25</span><span class="o">*</span><span class="n">deg_rad</span><span class="p">,</span> <span class="mf">0.25</span><span class="o">*</span><span class="n">deg_rad</span><span class="p">,</span> <span class="mf">0.25</span><span class="o">*</span><span class="n">deg_rad</span><span class="p">,</span> <span class="mf">0.25</span><span class="o">*</span><span class="n">deg_rad</span><span class="p">,</span> <span class="mf">0.25</span><span class="o">*</span><span class="n">deg_rad</span><span class="p">,</span> <span class="n">deg_rad</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">deg_rad</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">deg_rad</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">deg_rad</span><span class="o">/</span><span class="mf">2.0</span><span class="p">]</span>
<span class="k">if</span> <span class="n">domask</span><span class="p">:</span>
    <span class="n">locstream</span><span class="p">[</span><span class="s2">&quot;ESMF:Mask&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="create-a-grid-or-mesh-from-file">
<h2>Create a Grid or Mesh from File<a class="headerlink" href="#create-a-grid-or-mesh-from-file" title="Permalink to this headline">¶</a></h2>
<section id="file-formats">
<h3>File Formats<a class="headerlink" href="#file-formats" title="Permalink to this headline">¶</a></h3>
<p>ESMPy can create <a class="reference internal" href="grid.html#ESMF.api.grid.Grid" title="ESMF.api.grid.Grid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Grid</span></code></a> or <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a> objects from NetCDF files in a variety
of formats.  A <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a> can be created from files in <a class="reference internal" href="FileFormat.html#ESMF.api.constants.FileFormat.SCRIP" title="ESMF.api.constants.FileFormat.SCRIP"><code class="xref py py-class docutils literal notranslate"><span class="pre">SCRIP</span></code></a>, <a class="reference internal" href="FileFormat.html#ESMF.api.constants.FileFormat.ESMFMESH" title="ESMF.api.constants.FileFormat.ESMFMESH"><code class="xref py py-class docutils literal notranslate"><span class="pre">ESMFMESH</span></code></a>, and <a class="reference internal" href="FileFormat.html#ESMF.api.constants.FileFormat.UGRID" title="ESMF.api.constants.FileFormat.UGRID"><code class="xref py py-class docutils literal notranslate"><span class="pre">UGRID</span></code></a>
formats.  <a class="reference internal" href="grid.html#ESMF.api.grid.Grid" title="ESMF.api.grid.Grid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Grid</span></code></a> files can be in <a class="reference internal" href="FileFormat.html#ESMF.api.constants.FileFormat.SCRIP" title="ESMF.api.constants.FileFormat.SCRIP"><code class="xref py py-class docutils literal notranslate"><span class="pre">SCRIP</span></code></a> and <a class="reference internal" href="FileFormat.html#ESMF.api.constants.FileFormat.GRIDSPEC" title="ESMF.api.constants.FileFormat.GRIDSPEC"><code class="xref py py-class docutils literal notranslate"><span class="pre">GRIDSPEC</span></code></a> format.</p>
<section id="scrip">
<h4>SCRIP<a class="headerlink" href="#scrip" title="Permalink to this headline">¶</a></h4>
<p>This file format is used by the <a class="reference internal" href="FileFormat.html#ESMF.api.constants.FileFormat.SCRIP" title="ESMF.api.constants.FileFormat.SCRIP"><code class="xref py py-class docutils literal notranslate"><span class="pre">SCRIP</span></code></a> <a class="bibtex reference internal" href="appendix.html#ref-scrip" id="id6">[1]</a>, package, grid files that
work with that package should also work here.  <a class="reference internal" href="FileFormat.html#ESMF.api.constants.FileFormat.SCRIP" title="ESMF.api.constants.FileFormat.SCRIP"><code class="xref py py-class docutils literal notranslate"><span class="pre">SCRIP</span></code></a> format files are
capable of storing either 2D logically rectangular grids or 2D
unstructured grids.  More information can be found in the
<a class="reference external" href="http://earthsystemmodeling.org/docs/release/latest/ESMF_refdoc/">ESMF Reference Manual</a>.</p>
</section>
<section id="esmfmesh">
<h4>ESMFMESH<a class="headerlink" href="#esmfmesh" title="Permalink to this headline">¶</a></h4>
<p>ESMF has a custom unstructured grid file format for describing <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Meshes</span></code></a>.
This format is more compatible than the <a class="reference internal" href="FileFormat.html#ESMF.api.constants.FileFormat.SCRIP" title="ESMF.api.constants.FileFormat.SCRIP"><code class="xref py py-class docutils literal notranslate"><span class="pre">SCRIP</span></code></a> format with the methods
used to create a <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a> object, so less conversion needs to be done to
create a <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a>. The <a class="reference internal" href="FileFormat.html#ESMF.api.constants.FileFormat.ESMFMESH" title="ESMF.api.constants.FileFormat.ESMFMESH"><code class="xref py py-class docutils literal notranslate"><span class="pre">ESMFMESH</span></code></a> format is thus more efficient than <a class="reference internal" href="FileFormat.html#ESMF.api.constants.FileFormat.SCRIP" title="ESMF.api.constants.FileFormat.SCRIP"><code class="xref py py-class docutils literal notranslate"><span class="pre">SCRIP</span></code></a> when
used with ESMPy.  More information can be found in the
<a class="reference external" href="http://earthsystemmodeling.org/docs/release/latest/ESMF_refdoc/">ESMF Reference Manual</a>.</p>
</section>
<section id="gridspec">
<h4>GRIDSPEC<a class="headerlink" href="#gridspec" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="FileFormat.html#ESMF.api.constants.FileFormat.GRIDSPEC" title="ESMF.api.constants.FileFormat.GRIDSPEC"><code class="xref py py-class docutils literal notranslate"><span class="pre">GRIDSPEC</span></code></a> is an extension to the Climate and Forecast (CF) metadata
conventions for the representation of gridded data for Earth System
Models.  ESMPy supports NetCDF files that follow the CF <a class="reference internal" href="FileFormat.html#ESMF.api.constants.FileFormat.GRIDSPEC" title="ESMF.api.constants.FileFormat.GRIDSPEC"><code class="xref py py-class docutils literal notranslate"><span class="pre">GRIDSPEC</span></code></a>
convention to support logically rectangular lat/lon grids.  More
information can be found in the
<a class="reference external" href="http://earthsystemmodeling.org/docs/release/latest/ESMF_refdoc/">ESMF Reference Manual</a>.</p>
</section>
<section id="ugrid">
<h4>UGRID<a class="headerlink" href="#ugrid" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="FileFormat.html#ESMF.api.constants.FileFormat.UGRID" title="ESMF.api.constants.FileFormat.UGRID"><code class="xref py py-class docutils literal notranslate"><span class="pre">UGRID</span></code></a> is an extension to the CF metadata
conventions for the unstructured grid data model.  ESMPy support
NetCDF files that follow the CF <a class="reference internal" href="FileFormat.html#ESMF.api.constants.FileFormat.UGRID" title="ESMF.api.constants.FileFormat.UGRID"><code class="xref py py-class docutils literal notranslate"><span class="pre">UGRID</span></code></a> convention for unstructured grids.
More information can be found in the
<a class="reference external" href="http://earthsystemmodeling.org/docs/release/latest/ESMF_refdoc/">ESMF Reference Manual</a>.</p>
</section>
</section>
<section id="meshes-from-file">
<h3>Meshes from File<a class="headerlink" href="#meshes-from-file" title="Permalink to this headline">¶</a></h3>
<p>When creating a <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a> from a <a class="reference internal" href="FileFormat.html#ESMF.api.constants.FileFormat.SCRIP" title="ESMF.api.constants.FileFormat.SCRIP"><code class="xref py py-class docutils literal notranslate"><span class="pre">SCRIP</span></code></a> format file, there are a number of
options to control the output <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a>. The data is located at the center
of the grid cell in a <a class="reference internal" href="FileFormat.html#ESMF.api.constants.FileFormat.SCRIP" title="ESMF.api.constants.FileFormat.SCRIP"><code class="xref py py-class docutils literal notranslate"><span class="pre">SCRIP</span></code></a> grid. Therefore, when the <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a> will be
part of a conservative regridding operation, the <code class="docutils literal notranslate"><span class="pre">convert_to_dual</span></code>
flag must be set to True to properly generate coordinates at the the
cell corners.</p>
<p>A <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a> may also be created with boolean flags to specify whether or not to
add an area property to the <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a> <code class="docutils literal notranslate"><span class="pre">add_user_area</span></code>, or to add a mask
<code class="docutils literal notranslate"><span class="pre">add_mask</span></code> held by the NetCDF variable indicated in the optional argument,
<code class="docutils literal notranslate"><span class="pre">varname</span></code>.  These argument are only valid for <a class="reference internal" href="FileFormat.html#ESMF.api.constants.FileFormat.UGRID" title="ESMF.api.constants.FileFormat.UGRID"><code class="xref py py-class docutils literal notranslate"><span class="pre">UGRID</span></code></a> formatted files.
The mask generated for a <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a> created from file will
have 0 for the masked values and 1 for the unmasked values.</p>
</section>
<section id="grids-from-file">
<h3>Grids from File<a class="headerlink" href="#grids-from-file" title="Permalink to this headline">¶</a></h3>
<p>A number of optional boolean arguments are also supported to create a
structured <a class="reference internal" href="grid.html#ESMF.api.grid.Grid" title="ESMF.api.grid.Grid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Grid</span></code></a> from a file.  These include <code class="docutils literal notranslate"><span class="pre">is_sphere</span></code> to indicate whether
the grid is spherical or regional, <code class="docutils literal notranslate"><span class="pre">add_corner_stagger</span></code> to add the corner
stagger information to the <a class="reference internal" href="grid.html#ESMF.api.grid.Grid" title="ESMF.api.grid.Grid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Grid</span></code></a> for conservative regridding, and
<code class="docutils literal notranslate"><span class="pre">add_user_area</span></code> to specify whether to read in the cell area from the
NetCDF file or to calculate them.</p>
<p>For <a class="reference internal" href="FileFormat.html#ESMF.api.constants.FileFormat.GRIDSPEC" title="ESMF.api.constants.FileFormat.GRIDSPEC"><code class="xref py py-class docutils literal notranslate"><span class="pre">GRIDSPEC</span></code></a> formated files
there is the <code class="docutils literal notranslate"><span class="pre">add_mask</span></code> optional argument
to add a mask held by the NetCDF variable indicated in optional
argument, <code class="docutils literal notranslate"><span class="pre">varname</span></code>, and the <code class="docutils literal notranslate"><span class="pre">coord_names</span></code> argument to specify the longitude
and latitude variable names in a <a class="reference internal" href="FileFormat.html#ESMF.api.constants.FileFormat.GRIDSPEC" title="ESMF.api.constants.FileFormat.GRIDSPEC"><code class="xref py py-class docutils literal notranslate"><span class="pre">GRIDSPEC</span></code></a> file containing multiple sets of
coordinates.</p>
<p>For <a class="reference internal" href="FileFormat.html#ESMF.api.constants.FileFormat.SCRIP" title="ESMF.api.constants.FileFormat.SCRIP"><code class="xref py py-class docutils literal notranslate"><span class="pre">SCRIP</span></code></a> formated files the integer array <code class="docutils literal notranslate"><span class="pre">grid_imask</span></code> is used to mask out grid cells which should not participate in the regridding.</p>
<p>The mask generated for a <a class="reference internal" href="grid.html#ESMF.api.grid.Grid" title="ESMF.api.grid.Grid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Grid</span></code></a> created from
file (any format) will have 0 for the masked values and 1 for the unmasked values.</p>
</section>
</section>
<section id="regridding">
<h2>Regridding<a class="headerlink" href="#regridding" title="Permalink to this headline">¶</a></h2>
<p>The following table describe the regridding methods and options that are
available in ESMPy, the flag that is required to use it and a short description.
More information can be found on these options in the
<a class="reference external" href="http://earthsystemmodeling.org/docs/release/latest/ESMF_refdoc/">ESMF Reference Manual</a>.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 53%" />
<col style="width: 47%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Class</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference internal" href="RegridMethod.html#ESMF.api.constants.RegridMethod.BILINEAR" title="ESMF.api.constants.RegridMethod.BILINEAR"><code class="xref py py-class docutils literal notranslate"><span class="pre">BILINEAR</span></code></a></p></td>
<td><p>Linear regridding in two dimensions</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="RegridMethod.html#ESMF.api.constants.RegridMethod.PATCH" title="ESMF.api.constants.RegridMethod.PATCH"><code class="xref py py-class docutils literal notranslate"><span class="pre">PATCH</span></code></a></p></td>
<td><p>Higher-order least squares method</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="RegridMethod.html#ESMF.api.constants.RegridMethod.NEAREST_STOD" title="ESMF.api.constants.RegridMethod.NEAREST_STOD"><code class="xref py py-class docutils literal notranslate"><span class="pre">NEAREST_STOD</span></code></a></p></td>
<td><p>Nearest source point used for each destination</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="RegridMethod.html#ESMF.api.constants.RegridMethod.NEAREST_DTOS" title="ESMF.api.constants.RegridMethod.NEAREST_DTOS"><code class="xref py py-class docutils literal notranslate"><span class="pre">NEAREST_DTOS</span></code></a></p></td>
<td><p>Nearest destination point used for each source</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="RegridMethod.html#ESMF.api.constants.RegridMethod.CONSERVE" title="ESMF.api.constants.RegridMethod.CONSERVE"><code class="xref py py-class docutils literal notranslate"><span class="pre">CONSERVE</span></code></a></p></td>
<td><p>First-order conservative</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="RegridMethod.html#ESMF.api.constants.RegridMethod.CONSERVE_2ND" title="ESMF.api.constants.RegridMethod.CONSERVE_2ND"><code class="xref py py-class docutils literal notranslate"><span class="pre">CONSERVE_2ND</span></code></a></p></td>
<td><p>Second-order conservative</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="NormType.html#ESMF.api.constants.NormType" title="ESMF.api.constants.NormType"><code class="xref py py-class docutils literal notranslate"><span class="pre">NormType</span></code></a></p></td>
<td><p>Normalization options for integral conservation</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="LineType.html#ESMF.api.constants.LineType" title="ESMF.api.constants.LineType"><code class="xref py py-class docutils literal notranslate"><span class="pre">LineType</span></code></a></p></td>
<td><p>Line types for spherical and Cartesian space</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="UnmappedAction.html#ESMF.api.constants.UnmappedAction" title="ESMF.api.constants.UnmappedAction"><code class="xref py py-class docutils literal notranslate"><span class="pre">UnmappedAction</span></code></a></p></td>
<td><p>Unmapped destination point handling options</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="CoordSys.html#ESMF.api.constants.CoordSys" title="ESMF.api.constants.CoordSys"><code class="xref py py-class docutils literal notranslate"><span class="pre">CoordSys</span></code></a></p></td>
<td><p>Spherical grids and pole handling</p></td>
</tr>
</tbody>
</table>
<section id="great-circle-cells">
<h3>Great Circle Cells<a class="headerlink" href="#great-circle-cells" title="Permalink to this headline">¶</a></h3>
<p>For Grids and Meshes on a sphere some combinations of interpolation options
(e.g. first and second-order conservative methods) use cells whose edges are
great circles. This section describes some behavior that the user may not expect
from these cells and some potential solutions. A great circle edge isn’t
necessarily the same as a straight line in latitude longitude space. For small
edges, this difference will be small, but for long edges it could be
significant. This means if the user expects cell edges as straight lines in
latitude longitude space, they should avoid using one large cell with long edges
to compute an average over a region (e.g. over an ocean basin).</p>
<p>Also, the user should also avoid using cells that contain one edge that runs
half way or more around the earth, because the regrid weight calculation assumes
the edge follows the shorter great circle path. There isn’t a unique great
circle edge defined between points on the exact opposite side of the earth from
one another (antipodal points). However, the user can work around both of these
problem by breaking the long edge into two smaller edges by inserting an extra
node, or by breaking the large target grid cells into two or more smaller grid
cells. This allows the application to resolve the ambiguity in edge direction.</p>
</section>
</section>
<section id="id15">
<h2>Masking<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h2>
<p id="id16">Masking is the process whereby parts of a <a class="reference internal" href="grid.html#ESMF.api.grid.Grid" title="ESMF.api.grid.Grid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Grid</span></code></a>, <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a> or <a class="reference internal" href="locstream.html#ESMF.api.locstream.LocStream" title="ESMF.api.locstream.LocStream"><code class="xref py py-class docutils literal notranslate"><span class="pre">LocStream</span></code></a> can be marked to be ignored
during an operation, such as when they are used in regridding. Masking can be used on a <a class="reference internal" href="field.html#ESMF.api.field.Field" title="ESMF.api.field.Field"><code class="xref py py-class docutils literal notranslate"><span class="pre">Field</span></code></a>
created from a regridding source to indicate that certain portions should not be used to generate
regridded data. This is useful, for example, if a portion of the source contains unusable values.
Masking can also be used on a <a class="reference internal" href="field.html#ESMF.api.field.Field" title="ESMF.api.field.Field"><code class="xref py py-class docutils literal notranslate"><span class="pre">Field</span></code></a> created from a regridding destination to indicate that a certain
portion should not receive regridded data. This is useful, for example, when part of the destination
isn’t being used (e.g. the land portion of an ocean grid).</p>
<p>The user may mask out points in the source <a class="reference internal" href="field.html#ESMF.api.field.Field" title="ESMF.api.field.Field"><code class="xref py py-class docutils literal notranslate"><span class="pre">Field</span></code></a> or destination <a class="reference internal" href="field.html#ESMF.api.field.Field" title="ESMF.api.field.Field"><code class="xref py py-class docutils literal notranslate"><span class="pre">Field</span></code></a> or both. To do masking the user
sets mask information in the <a class="reference internal" href="grid.html#ESMF.api.grid.Grid" title="ESMF.api.grid.Grid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Grid</span></code></a>, <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a>, or <a class="reference internal" href="locstream.html#ESMF.api.locstream.LocStream" title="ESMF.api.locstream.LocStream"><code class="xref py py-class docutils literal notranslate"><span class="pre">LocStream</span></code></a> upon
which the <a class="reference internal" href="field.html#ESMF.api.field.Field" title="ESMF.api.field.Field"><code class="xref py py-class docutils literal notranslate"><span class="pre">Fields</span></code></a> passed into the <a class="reference internal" href="regrid.html#ESMF.api.regrid.Regrid" title="ESMF.api.regrid.Regrid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Regrid</span></code></a> call are built. The <code class="docutils literal notranslate"><span class="pre">src_mask_values</span></code> and
<code class="docutils literal notranslate"><span class="pre">dst_mask_values</span></code> arguments to that call can then be used to specify which values in that mask information
indicate that a location should be masked out. For example, if <code class="docutils literal notranslate"><span class="pre">dst_mask_values</span></code> is set to [1,2], then any
location that has a value of 1 or 2 in the mask information of the <a class="reference internal" href="grid.html#ESMF.api.grid.Grid" title="ESMF.api.grid.Grid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Grid</span></code></a>, <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a> or <a class="reference internal" href="locstream.html#ESMF.api.locstream.LocStream" title="ESMF.api.locstream.LocStream"><code class="xref py py-class docutils literal notranslate"><span class="pre">LocStream</span></code></a> upon which
the destination <a class="reference internal" href="field.html#ESMF.api.field.Field" title="ESMF.api.field.Field"><code class="xref py py-class docutils literal notranslate"><span class="pre">Field</span></code></a> is built will be masked out.</p>
<p>Masking behavior differs slightly between regridding methods. For non-conservative regridding methods
(e.g. bilinear or high-order patch), masking is done on points. For these methods, masking a destination
point means that the point will not participate in regridding. For these
methods, masking a source point means that the entire source cell using that point is masked out.
In other words, if any corner point making up a source cell is masked then the cell is masked.
For conservative regridding methods masking is done on cells.
Masking a destination cell means that the cell won’t participate in regridding.
Similarly, masking a source cell means that the cell won’t participate in regridding.
For any type of interpolation method (conservative or non-conservative)
the masking is set on the location upon which the
<a class="reference internal" href="field.html#ESMF.api.field.Field" title="ESMF.api.field.Field"><code class="xref py py-class docutils literal notranslate"><span class="pre">Fields</span></code></a> passed into the regridding call are built.
For example, if <a class="reference internal" href="field.html#ESMF.api.field.Field" title="ESMF.api.field.Field"><code class="xref py py-class docutils literal notranslate"><span class="pre">Fields</span></code></a> built on
<a class="reference internal" href="StaggerLoc.html#ESMF.api.constants.StaggerLoc.CENTER" title="ESMF.api.constants.StaggerLoc.CENTER"><code class="xref py py-class docutils literal notranslate"><span class="pre">StaggerLoc.CENTER</span></code></a> are passed into
<a class="reference internal" href="regrid.html#ESMF.api.regrid.Regrid" title="ESMF.api.regrid.Regrid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Regrid</span></code></a>
then the masking should also be set on <a class="reference internal" href="StaggerLoc.html#ESMF.api.constants.StaggerLoc.CENTER" title="ESMF.api.constants.StaggerLoc.CENTER"><code class="xref py py-class docutils literal notranslate"><span class="pre">StaggerLoc.CENTER</span></code></a>.</p>
<p>The mask generated for a <a class="reference internal" href="grid.html#ESMF.api.grid.Grid" title="ESMF.api.grid.Grid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Grid</span></code></a>,
<a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a> or <a class="reference internal" href="locstream.html#ESMF.api.locstream.LocStream" title="ESMF.api.locstream.LocStream"><code class="xref py py-class docutils literal notranslate"><span class="pre">LocStream</span></code></a> created
from file will have 0 for the masked values and 1 for the unmasked values.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <a class="reference internal" href="Region.html#ESMF.api.constants.Region.SELECT" title="ESMF.api.constants.Region.SELECT"><code class="xref py py-class docutils literal notranslate"><span class="pre">Region.SELECT</span></code></a> flag to the</p>
</div>
<p><code class="docutils literal notranslate"><span class="pre">zero_region</span></code> parameter of <a class="reference internal" href="regrid.html#ESMF.api.regrid.Regrid" title="ESMF.api.regrid.Regrid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Regrid</span></code></a> can be used to
maintain <a class="reference internal" href="field.html#ESMF.api.field.Field" title="ESMF.api.field.Field"><code class="xref py py-class docutils literal notranslate"><span class="pre">Fields</span></code></a> values on locations that do not
participate in the regridding operation. This is useful when setting an
uninitialized value to help identify masked locations within the
<a class="reference internal" href="field.html#ESMF.api.field.Field" title="ESMF.api.field.Field"><code class="xref py py-class docutils literal notranslate"><span class="pre">Fields</span></code></a> data.</p>
</section>
<section id="numpy-slicing-and-indexing">
<h2>Numpy Slicing and Indexing<a class="headerlink" href="#numpy-slicing-and-indexing" title="Permalink to this headline">¶</a></h2>
<p>Numpy arrays are used to represent <a class="reference internal" href="grid.html#ESMF.api.grid.Grid" title="ESMF.api.grid.Grid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Grid</span></code></a>, <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a> and <a class="reference internal" href="locstream.html#ESMF.api.locstream.LocStream" title="ESMF.api.locstream.LocStream"><code class="xref py py-class docutils literal notranslate"><span class="pre">LocStream</span></code></a> coordinates and <a class="reference internal" href="field.html#ESMF.api.field.Field" title="ESMF.api.field.Field"><code class="xref py py-class docutils literal notranslate"><span class="pre">Field</span></code></a> data,
among other things.  Standard numpy conventions for array indexing
and slicing can be expected.  There are some exceptions when it comes to fancy
indexing, index arrays, and multi-dimensional slicing.  Significant effort has
been put into raising exceptions where inappropriate indexing or slicing
operations are attempted.</p>
<p>It is very important to remember that all indexing
and slicing operations apply <strong>ONLY</strong> to the ESMPy level objects, and these operations
do not propagate down to the lower-level Fortran- and C-based representations
of the ESMF objects.  One example of where this could come up is when passing
a <a class="reference internal" href="field.html#ESMF.api.field.Field" title="ESMF.api.field.Field"><code class="xref py py-class docutils literal notranslate"><span class="pre">Field</span></code></a> slice into regridding.  The entire original <a class="reference internal" href="field.html#ESMF.api.field.Field" title="ESMF.api.field.Field"><code class="xref py py-class docutils literal notranslate"><span class="pre">Field</span></code></a> will still be run
through the ESMF regridding engine, and only the appropriate portion of
the <a class="reference internal" href="field.html#ESMF.api.field.Field" title="ESMF.api.field.Field"><code class="xref py py-class docutils literal notranslate"><span class="pre">Field</span></code></a> slice will be updated with the regridded values.</p>
<section id="dimension-ordering">
<h3>Dimension Ordering<a class="headerlink" href="#dimension-ordering" title="Permalink to this headline">¶</a></h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The underlying ESMF library is built with a mix of Fortran and C/C++
and follows Fortran conventions with respect to array indexing and
dimension ordering. Some effort has been made to make ESMPy feel more
natural to the Python user where possible. This means that ESMPy uses
0-based indexing, which is translated to the 1-based indexing used by
the ESMPy backend. However, the dimension ordering still follows
Fortran conventions. Namely, longitude comes before latitude, which
also comes before temporal dimensions when in use.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
   <span class="o">...</span><span class="p">:</span> <span class="kn">import</span> <span class="nn">ESMF</span>
   <span class="o">...</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span> <span class="n">grid</span> <span class="o">=</span> <span class="n">ESMF</span><span class="o">.</span><span class="n">Grid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]),</span> <span class="n">staggerloc</span><span class="o">=</span><span class="n">ESMF</span><span class="o">.</span><span class="n">StaggerLoc</span><span class="o">.</span><span class="n">CENTER</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span> <span class="n">gridLon</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">get_coords</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span> <span class="n">gridLat</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">get_coords</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span> <span class="n">lon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">120</span><span class="p">,</span><span class="mi">120</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span> <span class="n">lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">67.5</span><span class="p">,</span> <span class="mf">67.5</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span> <span class="n">lonm</span><span class="p">,</span> <span class="n">latm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s1">&#39;ij&#39;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span> <span class="n">gridLon</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">lonm</span>
   <span class="o">...</span><span class="p">:</span> <span class="n">gridLat</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">latm</span>
   <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">grid</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="n">ESMF</span><span class="o">.</span><span class="n">StaggerLoc</span><span class="o">.</span><span class="n">CENTER</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">lon</span><span class="o">.</span><span class="n">shape</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="p">(</span><span class="mi">3</span><span class="p">,)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">lat</span><span class="o">.</span><span class="n">shape</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="p">(</span><span class="mi">4</span><span class="p">,)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">grid</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="n">ESMF</span><span class="o">.</span><span class="n">StaggerLoc</span><span class="o">.</span><span class="n">CENTER</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span>
<span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mf">120.</span><span class="p">,</span> <span class="o">-</span><span class="mf">120.</span><span class="p">,</span> <span class="o">-</span><span class="mf">120.</span><span class="p">,</span> <span class="o">-</span><span class="mf">120.</span><span class="p">],</span>
       <span class="p">[</span>   <span class="mf">0.</span><span class="p">,</span>    <span class="mf">0.</span><span class="p">,</span>    <span class="mf">0.</span><span class="p">,</span>    <span class="mf">0.</span><span class="p">],</span>
       <span class="p">[</span> <span class="mf">120.</span><span class="p">,</span>  <span class="mf">120.</span><span class="p">,</span>  <span class="mf">120.</span><span class="p">,</span>  <span class="mf">120.</span><span class="p">]])</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">grid</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="n">ESMF</span><span class="o">.</span><span class="n">StaggerLoc</span><span class="o">.</span><span class="n">CENTER</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span>
<span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mf">67.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">22.5</span><span class="p">,</span>  <span class="mf">22.5</span><span class="p">,</span>  <span class="mf">67.5</span><span class="p">],</span>
       <span class="p">[</span><span class="o">-</span><span class="mf">67.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">22.5</span><span class="p">,</span>  <span class="mf">22.5</span><span class="p">,</span>  <span class="mf">67.5</span><span class="p">],</span>
       <span class="p">[</span><span class="o">-</span><span class="mf">67.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">22.5</span><span class="p">,</span>  <span class="mf">22.5</span><span class="p">,</span>  <span class="mf">67.5</span><span class="p">]])</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">field</span> <span class="o">=</span> <span class="n">ESMF</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">ndbounds</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">])</span> <span class="c1"># create a Field with a time dimension</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">field</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="parallel-execution">
<h2>Parallel Execution<a class="headerlink" href="#parallel-execution" title="Permalink to this headline">¶</a></h2>
<p>ESMPy is a thin wrapper on top of ESMF, which was designed for high performance
and scalable computing. The ESMF virtual machine is used to manage the available
resources of the execution environment in a layer that is transparent to the
ESMPy user. This allows the full power of the high performance computing
environment to be utilized by the ESMPy user with little use of specialized
parallel programming techniques.</p>
<p>ESMPy objects will be distributed across the available computing resources with
no additional parameters required. The <a class="reference internal" href="grid.html#ESMF.api.grid.Grid" title="ESMF.api.grid.Grid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Grid</span></code></a>, <a class="reference internal" href="mesh.html#ESMF.api.mesh.Mesh" title="ESMF.api.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a>, <a class="reference internal" href="locstream.html#ESMF.api.locstream.LocStream" title="ESMF.api.locstream.LocStream"><code class="xref py py-class docutils literal notranslate"><span class="pre">LocStream</span></code></a>, and <a class="reference internal" href="field.html#ESMF.api.field.Field" title="ESMF.api.field.Field"><code class="xref py py-class docutils literal notranslate"><span class="pre">Field</span></code></a> classes
will all be transparently “parallelized” with no need for user calls to a
message passing interface. Likewise, the <a class="reference internal" href="regrid.html#ESMF.api.regrid.Regrid" title="ESMF.api.regrid.Regrid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Regrid</span></code></a> class will compute and apply
the interpolation weights using all available computing resources with no need
for user intervention.</p>
<p>However, it is useful to remember that resulting <a class="reference internal" href="field.html#ESMF.api.field.Field" title="ESMF.api.field.Field"><code class="xref py py-class docutils literal notranslate"><span class="pre">Field</span></code></a> values will only be
accessible on certain PETs. The mpi4py package may be necessary for post
processing tasks that require access to global <a class="reference internal" href="field.html#ESMF.api.field.Field" title="ESMF.api.field.Field"><code class="xref py py-class docutils literal notranslate"><span class="pre">Field</span></code></a> values.</p>
<section id="mpirun-vs-mpi-spawn">
<h3>mpirun vs. MPI.Spawn<a class="headerlink" href="#mpirun-vs-mpi-spawn" title="Permalink to this headline">¶</a></h3>
<p>There are a few different options for using ESMPy in a parallel
environment. Using mpirun to specify the desired number of computing cores
is probably the easiest way to start a parallel ESMPy job. Another option is to
call the MPI.Spawn() function from the mpi4py Python package from within a
serial Python script or interpreter. It has been observed that MPI.Spawn() may
not work properly when mpi4py is built with an underlying mpich
library, openmpi has seen better success. A third option is to call mpirun
using a system call from within a serial Python script or interpreter, however
this method is not highly recommended.</p>
<p>The following two examples demonstrate how to execute an ESMPy script in
parallel. Any of the scripts found in the examples directory of the ESMPy source
code can be run in parallel using mpirun as well as in serial mode.</p>
<section id="mpirun">
<h4>mpirun<a class="headerlink" href="#mpirun" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mpirun</span> <span class="o">-</span><span class="n">n</span> <span class="mi">4</span> <span class="n">python</span> <span class="n">hello_world</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
</section>
<section id="mpi-spawn">
<h4>MPI.Spawn<a class="headerlink" href="#mpi-spawn" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">mpi4py</span> <span class="kn">import</span> <span class="n">MPI</span>

<span class="c1"># Parent</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>

    <span class="c1"># Spawn workers</span>
    <span class="n">comm</span> <span class="o">=</span> <span class="n">MPI</span><span class="o">.</span><span class="n">COMM_WORLD</span><span class="o">.</span><span class="n">Spawn</span><span class="p">(</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span>
        <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;worker&#39;</span><span class="p">],</span>
        <span class="n">maxprocs</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

    <span class="c1"># Shutdown</span>
    <span class="n">comm</span><span class="o">.</span><span class="n">Disconnect</span><span class="p">()</span>

<span class="c1"># Worker</span>
<span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;worker&#39;</span><span class="p">:</span>

    <span class="c1"># Connect to parent</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">comm</span> <span class="o">=</span> <span class="n">MPI</span><span class="o">.</span><span class="n">Comm</span><span class="o">.</span><span class="n">Get_parent</span><span class="p">()</span>
        <span class="n">rank</span> <span class="o">=</span> <span class="n">comm</span><span class="o">.</span><span class="n">Get_rank</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Could not connect to parent - &#39;</span> <span class="o">+</span> <span class="n">usage</span><span class="p">)</span>

    <span class="c1"># worker code goes here, regridding etc..</span>
    <span class="nb">print</span> <span class="s2">&quot;Hello World from PET #&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">rank</span><span class="p">)</span>

    <span class="c1"># Shutdown</span>
    <span class="n">comm</span><span class="o">.</span><span class="n">Disconnect</span><span class="p">()</span>

<span class="c1"># Catch</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Program should be started without arguments&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>A more detailed example of using MPI.Spawn() can be found in the Tutorials section
of the documentation.</p>
</section>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">API</a><ul>
<li><a class="reference internal" href="#classes">Classes</a></li>
<li><a class="reference internal" href="#named-constants">Named Constants</a></li>
<li><a class="reference internal" href="#manager">Manager</a><ul>
<li><a class="reference internal" href="#resource-allocation">Resource Allocation</a></li>
<li><a class="reference internal" href="#logging">Logging</a></li>
<li><a class="reference internal" href="#garbage-collection">Garbage Collection</a></li>
<li><a class="reference internal" href="#moab-mesh-backend">MOAB Mesh backend</a></li>
</ul>
</li>
<li><a class="reference internal" href="#spatial-discretization-objects">Spatial Discretization Objects</a><ul>
<li><a class="reference internal" href="#grid">Grid</a><ul>
<li><a class="reference internal" href="#staggering">Staggering</a></li>
<li><a class="reference internal" href="#spherical-coordinates">Spherical Coordinates</a></li>
<li><a class="reference internal" href="#periodicity">Periodicity</a></li>
<li><a class="reference internal" href="#pole-generation">Pole Generation</a></li>
<li><a class="reference internal" href="#masking">Masking</a></li>
<li><a class="reference internal" href="#cell-areas">Cell Areas</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mesh">Mesh</a><ul>
<li><a class="reference internal" href="#mesh-creation">Mesh Creation</a></li>
<li><a class="reference internal" href="#id3">Masking</a></li>
<li><a class="reference internal" href="#areas">Areas</a></li>
</ul>
</li>
<li><a class="reference internal" href="#locstream">LocStream</a></li>
</ul>
</li>
<li><a class="reference internal" href="#create-a-grid-or-mesh-from-file">Create a Grid or Mesh from File</a><ul>
<li><a class="reference internal" href="#file-formats">File Formats</a><ul>
<li><a class="reference internal" href="#scrip">SCRIP</a></li>
<li><a class="reference internal" href="#esmfmesh">ESMFMESH</a></li>
<li><a class="reference internal" href="#gridspec">GRIDSPEC</a></li>
<li><a class="reference internal" href="#ugrid">UGRID</a></li>
</ul>
</li>
<li><a class="reference internal" href="#meshes-from-file">Meshes from File</a></li>
<li><a class="reference internal" href="#grids-from-file">Grids from File</a></li>
</ul>
</li>
<li><a class="reference internal" href="#regridding">Regridding</a><ul>
<li><a class="reference internal" href="#great-circle-cells">Great Circle Cells</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id15">Masking</a></li>
<li><a class="reference internal" href="#numpy-slicing-and-indexing">Numpy Slicing and Indexing</a><ul>
<li><a class="reference internal" href="#dimension-ordering">Dimension Ordering</a></li>
</ul>
</li>
<li><a class="reference internal" href="#parallel-execution">Parallel Execution</a><ul>
<li><a class="reference internal" href="#mpirun-vs-mpi-spawn">mpirun vs. MPI.Spawn</a><ul>
<li><a class="reference internal" href="#mpirun">mpirun</a></li>
<li><a class="reference internal" href="#mpi-spawn">MPI.Spawn</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="examples.html"
                          title="previous chapter">Tutorials</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="appendix.html"
                          title="next chapter">Appendices</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/api.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="appendix.html" title="Appendices"
             >next</a> |</li>
        <li class="right" >
          <a href="examples.html" title="Tutorials"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">ESMPy 8.3.0 beta snapshot documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">API</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2011-2020, University Corporation for Atmospheric Research, Massachusetts Institute of Technology, Geophysical Fluid Dynamics Laboratory, University of Michigan, National Centers for Environmental Prediction, Los Alamos National Laboratory, Argonne National Laboratory, NASA Goddard Space Flight Center.  Licensed under the University of Illinois-NCSA License.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.5.0.
    </div>
  </body>
</html>